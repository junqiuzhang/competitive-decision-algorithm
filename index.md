**摘要**

设施选址问题是一类复杂的运筹学问题，科学的设施选址决策具有十分深远的影响和十分重大的意义。本文在何永梅对软容量限制的设施选址问题的研究的基础上，重新对软容量限制的设施选址问题的数学性质进行了归纳整理，并重新整理了软容量限制的设施选址问题下的竞争决策算法，对该问题进行了求解。并且，将竞争决策算法推广到强容量限制的设施选址问题中，给出了强容量限制的设施选址问题中竞争决策算法流程，并使用大量算例验证了算法的有效性。此外，本文还在竞争决策算法的基础上结合混合策略的思想，提出了一种基于混合策略的竞争决策算法，即在竞争决策算法竞争完毕后按照一定的混合策略再分配一次顾客，之后比较混合策略分配的期望与竞争决策算法的解，取最好的解作为输出的解。并且，通过大量算例验证了算法的有效性。

关键词：选址问题 容量限制 竞争决策算法 混合策略

# 1 绪论

运筹学（opearations research）是应用数学的一个分支，主要是运用统计学、数学模型和算法等知识，研究实际生活中的复杂问题，得到复杂问题的最优或近似最优解，进而得到实际生活中复杂问题的最优解决方案或近似最优解决方案。所以，运筹学也称为广义最优化理论。

运筹学的萌芽是在18世纪到20世纪初。1736年，Euler运用图论的思想对哥尼斯堡七桥问题进行了研究，成为图论研究的起源；1738年，Bernoulli提出了效用这一概念，为决策论的研究奠定了基础；1777年，Buffon提出了利用随机投针法来计算$\pi$的方法，这是蒙特卡洛法的最早应用；1896年，Pareto提出了Pareto最优的概念，为多目标优化问题的研究奠定了基础；1909年，Erlang运用概率论相关知识研究了电话服务问题，成为排队论研究的起源；1912年，Zermelo首次研究了博弈论问题；1915年，Harris对商业中的库存问题的研究标志着库存论研究的起源；1916年，Borel提出了博弈论中的最优策略的概念，证明了一些博弈论问题存在最优策略；1928年，Von Nuemann深入研究了博弈论问题；1932年，Weibull研究了维修问题，这被认为是可靠性数学理论的起源；1939年，Kantorovich提出了线性规划模型，成为线性规划理论研究的起源。

运筹学的起源是在第二次世界大战期间。二战期间，英美等国家成立了军事数学小组，研究军事中的数学问题，并称这些研究为"opearation research"，也就是"运筹学"。二战之后，这些研究逐渐发表，并广泛应用于军事之外的其他领域。

运筹学的发展是在20世纪40年代到60年代。1947年，丹齐格研究了线性规划问题的一种解法----单纯形法，在1949年，线性规划理论建立，标志着运筹学大发展的到来。之后，1951年，非线性规划理论建立；1954年，网络流理论建立；1955年，随机规划理论建立；1958年，整数规划理论建立。同时，排队论、存储论、决策论和博弈论也都得到了巨大的发展。这期间，计算机的发明大大促进了运筹学的发展，使得运筹学中许多复杂的模型得以求解；同时，运筹学的发展也反过来促进了计算机的发展，使得计算机向更大规模更快速度的方向快速发展。

如今，运筹学已经被广泛应用在生产、生活、经济、管理、政治和军事的各个领域中，创造了巨大的社会财富。

运筹学中一个很重要的分支就是博弈论。博弈论起源于20世纪40年代，但是博弈论思想的起源却要久远的多，2000多年前我国的田忌赛马的故事中就应用了博弈论的思想；1838年Cournot提出的寡头垄断模型和1883年Bertrand提出的Bertrand模型中就有了博弈论的雏形；1928年Von Nuemann提出了非合作二人零和博弈的"最大最小定理"，这是博弈论发展历史上的一个里程碑；1944年Von Nuemann与Morgenstern合著出版了《博弈论和经济行为》，这标志着博弈论的正式建立；1950年Nash在博士论文中给出了纳什均衡的概念和了均衡点存在定理，为博弈论的更广泛应用打下了基础。之后，博弈论被广泛应用在经济学、政治学、生物学和计算机科学中。并且，博弈论的思想还被应用在很多启发式算法中，例如，竞争决策算法就借鉴了博弈论的思想，可以用于求解许多组合优化问题。

# 2 选址问题

在生产、生活、经济、管理中我们遇到的这类问题：在哪里建造工厂可以更好的降低成本？在哪里建造超市可以获得更多的利润？在哪里建造仓库可以提高物流的效率？在哪里布设路由器可以提升网络服务的速度？归纳起来，这类问题研究的是建造一定数量的设施（这些设施一般有固定的建设费用）来服务一定数量的顾客（有固定的服务费用），使得成本最低或利润最大的问题。这类问题在运筹学中统称为设施选址问题。

因为设施选址决策涉及到设施的类型、资金、竞争者、经济环境和运营现状等多方面的因素，是一个复杂的经济和社会行为过程。设施选址决策会影响服务的质量、服务的效率、服务的成本等方面，进而影响服务取得的利润和服务的竞争力。并且，选址的决策的影响是深远的，所以选址问题是重要的长期决策。所以，研究选址问题具有十分重要的经济和社会意义$^{\lbrack 1\rbrack}$。

1909年，Weber研究了如何在平面上选取一个仓库的位置使得仓库与多个顾客的总距离最小的问题$^{\lbrack 2\rbrack}$，这被认为是选址问题研究的开始。1964年，Hakimi研究了网络的$p -$中值问题和$p -$中心问题$^{\lbrack 3\rbrack}$，这篇文章推动选址问题的研究。自此之后，选址问题的相关研究论文数量急剧增多，选址问题的研究也开始活跃了起来$^{\lbrack 1\rbrack}$。

根据目标的不同，选址问题大致可以分为中值问题、覆盖问题和中心问题三种经典问题，下面对这三种问题分别进行了介绍。

## 2.1 $p -$中值选址问题

$p -$中值选址问题研究选取$p$个设施的位置来服务若干个顾客，使得总的成本最小的问题。$p -$中值问题的目标可以是使顾客到最近的设施的总距离最短，可以是总服务时间最少，也可以是总服务费用最少。

$p -$中值问题最早由Hakimi于1964年提出$^{\lbrack 3\rbrack}$，可以分为绝对$p -$中值问题和顶点$p -$中值问题，绝对$p -$中值问题是指可以选取网络上的任意位置作为设施的选址，而顶点$p -$中值问题则是指只能选取顶点作为设施的选址。绝对$p -$中值问题与顶点$p -$中值问题的有相同的最优解，区别就仅仅在于约束条件的不同，所以一般不区分这两种问题。在之后的研究中，Garey证明了$p -$中值问题是NP-hard问题；Hakimi和Kariv证明了$p -$中值问题是NP-完全的$^{\lbrack 4\rbrack}$；Goldman提出了在树和单环网络中1-中值问题的简单算法；Wesolowsky和Drezner研究了动态$p -$中值问题；Chen和Drezner研究了条件$p -$中值问题；Li研究了可靠$p -$中值问题；Diabat研究了封闭环中的中值问题；Revelle和Swain建立了$p -$中值问题的整数规划模型。

记顾客集合为$C$，候选设施集合$F$，任意顾客和候选设施之间都有一定的服务费用$d_{ij} \in R^{+}$，我们的目标就是在候选设施集合$F$中选取一个子集，使得每个顾客都有一个设施来服务，并且尽量使总成本最小，则$p -$中值问题的模型可以描述为：

$$min\sum_{i \in I}^{}{\sum_{j \in J}^{}{d_{ij}x_{ij}}}$$

$$s.t.\sum_{j \in J}^{}x_{ij} = 1,\ \forall i$$

$$x_{ij} - y_{j} \leq 0,\forall i,\forall j$$

$$\sum_{j \in J}^{}y_{j} \leq P$$

$$x_{ij},\ y_{j} \in \{ 0,\ 1\},\forall i,\forall j$$

其中，$i$为顾客的序号，$j$为候选设施的序号，$x_{ij}$为候选设施$j$是否为顾客$i$服务，若候选设施$j$为顾客i服务，则$x_{ij}$为1，否则为0，$y_{j}$为候选设施$j$是否建设，若候选设施$j$建设，则$y_{j}$为1，否则为0。约束（1）式表示候选设施至多只能为一个顾客服务，约束（2）式表示只有建立设施才能为顾客服务，约束（3）式表表示建立设施的最大数量不能超过P，约束（4）式是变量的取值范围约束。

$p -$中值问题可以用整数规划的求解方法来求解，例如对偶的多阶段法、对偶定界法、拉格朗日松弛法和分支定界法等等。还可以用一些启发式算法来求解，例如近似算法、交换启发式算法、邻域搜索算法、禁忌搜索算法、模拟退火算法、遗传算法和神经网络算法等等，也取得了不错的效果。

$p -$中值问题常常应用在企业选址中，例如工厂、仓库的选址，因为企业选址问题常常以成本最低为目标，这一类追求经济效益最大化的目标通常被称为"经济效益性"目标。同时，$p -$中值问题也可以应用于公共设施的选址中，例如学校、图书馆的选址。这一类追求公共服务效果最好的目标通常被称为"集体福利性"目标。$p -$中值问题常常解决的就是这两类目标的问题。

## 2.2 覆盖选址问题

首先，我们引入覆盖的概念：
当某个顾客可以在规定的服务费用内被某个设施服务，则称该顾客被该设施覆盖。而覆盖选址问题研究的就是用最少成本的设施来最大程度的满足顾客需求的问题。根据目标的不同，覆盖问题又可以分为集合覆盖问题和最大覆盖问题两种。

集合覆盖问题最早由Toregas于1971年提出$^{\lbrack 5\rbrack}$，其目标是建设若干设施在满足所有顾客需求的条件下使建设成本最小。记顾客集合为$C$，候选设施集合$F$，候选设施集合中的每个设施$F_{i}$都有一定的建设费用$f_{i} \in R^{+}$，任意顾客和候选设施之间都有一定的距离$d_{ij} \in R^{+}$，我们的目标就是在候选设施集合$F$中选取一个子集，使得每个顾客都有一个设施来服务，并且尽量使总成本最小，则模型可以描述为：

$$min\sum_{j \in J}^{}{f_{j}y_{j}}$$

$$s.t.\sum_{d_{ij} \leq D}^{}y_{j} \geq 1,\ \forall i$$

$$y_{j} \in \left\{ 0,1 \right\},\ \forall i,\forall j$$

其中，$y_{j}$为候选设施$j$是否建设，若候选设施$j$建设，则$y_{j}$为1，否则为0。约束（1）式表示每个顾客至少有一个候选设施为其服务，约束（2）式是变量的取值范围约束。

该模型假设了所有的顾客的需求都应被满足，但是实际上，如果某个顾客的需求量很小，那么为了满足这个顾客的需求而建设设施很可能导致入不敷出，所以就有了最大覆盖问题。

最大覆盖问题最早由Church RL和ReVelle C于1988年提出$^{\lbrack 6\rbrack}$，其目标是建设$p$个设施使顾客被满足的需求量最大。同样地，记顾客集合为$C$，候选设施集合$F$，顾客集合中的每个顾客$F_{i}$都有一定的需求量$f_{i} \in R^{+}$，任意顾客和候选设施之间都有一定的距离$d_{ij} \in R^{+}$，我们的目标就是在候选设施集合$F$中选取一个子集，使得顾客被满足的需求量最大，其模型可以被描述为：

$$min\sum_{i \in I}^{}{f_{i}x_{i}}$$

$$s.t.\sum_{d_{ij} \leq D}^{}y_{j} \geq x_{i},\ \forall i$$

$$\sum_{j \in J}^{}y_{j} \leq P$$

$$x_{i},\ y_{j} \in \{ 0,\ 1\},\forall i,\forall j$$

其中，$D$为设施与顾客之间允许的最大距离，$x_{i}$为顾客是否被覆盖，若顾客被覆盖，则$x_{i}$为1，否则为0。$y_{j}$为候选设施$j$是否建设，若候选设施$j$建设，则$y_{j}$为1，否则为0。约束（1）式表示顾客被覆盖时应当满足的条件，约束（2）式表示建立设施的最大数量不能超过$P$，约束（3）式是变量的取值范围约束。

一般网络上的覆盖选址问题是NP-完全的。集合覆盖问题的求解有精确求解方法，例如分支定界法、基于动态次梯度的分支定界法等等。另外，一些启发式算法也可以用来求解覆盖选址问题，例如替换启发式方法、拉格朗日松弛法、贪婪算法、遗传算法、神经网络算法、混合启发式算法以及其他启发式算法等等。而最大覆盖问题的求解的方法主要有分支定界法，除此之外就是贪婪添加算法、贪婪添加-替换算法、拉格朗日松弛法等启发式算法。

覆盖选址问题常常应用在应急服务设施的选址上，例如消防站、急救中心等，因为应急服务设施通常满足在一定时间内或者一定距离内可以服务到顾客即可（即覆盖到顾客），并且通常希望一定的应急服务设施服务到的顾客越多越好。

## 2.3 $p -$中心选址问题

$p -$中心选址问题研究选取$p$个设施的位置来服务若干个顾客，使得最差的情况达到最优的问题。$p -$中心问题的目标可以是最大距离最小，可以是最大反应时间最小，也可以是最大损失最小。

$p -$中心问题最早也是由Hakimi提出的$^{\lbrack 3\rbrack}$，可以分为绝对$p -$中心问题和顶点$p -$中心问题，其区别与$p -$中值问题的分类中的两种问题的区别类似，所以一般也不区分这两种问题。在之后的研究中，Kariv和Hakimi证明了$p -$中心问题是NP-hard问题$^{\lbrack 4\rbrack}$；Hedetnie研究了无权网络中的1-中心问题，Migiddo和Supowit证明了$p -$中心问题是NP-完全的。

记顾客集合为$C$，候选设施集合$F$，任意顾客和候选设施之间都有一定的服务费用$d_{ij} \in R^{+}$，我们的目标就是在候选设施集合$F$中选取一个子集，使得最差情况的服务费用达到最小，则$p -$中心选址模型可以描述为：

$$min D$$

$$s.t.\sum_{j \in J}^{}x_{ij} = 1,\forall i$$

$$x_{ij} - y_{j} \leq 0,\forall i,\ \forall j$$

$$\sum_{j \in J}^{}y_{j} = P$$

$$D - \sum_{j \in J}^{}{d_{ij}x_{ij}} \geq 0,\ \forall i$$

$$x_{ij},\ y_{j} \in \{ 0,\ 1\},\forall i,\forall j$$

其中，$D$为设施与顾客之间允许的最大服务费用，$x_{ij}$为候选设施$j$是否为顾客$i$服务，若候选设施$j$为顾客$i$服务，则$x_{ij}$为1，否则为0，$y_{j}$为候选设施$j$是否建设，若候选设施$j$建设，则$y_{j}$为1，否则为0。约束（1）式表示候选设施至多只能为一个顾客服务，约束（2）式表示只有建立设施才能为顾客服务，约束（3）式表表示建立设施的最大数量不能超过P，约束（4）式表示设施与顾客之间的服务费用要小于允许的最大服务费用，约束（5）式是变量的取值范围约束。

$p -$中心问题与$p -$中值问题的求解有很大的不同：对于无权顶点$p -$中心问题有“猜测”算法；对于一般的$p -$中心问题有Drezner和Wesolowsky提出的Drezner-Wesolowsky方法；对于顶点$p -$中心问题有Daskin提出的二分搜索算法。同时，一些启发式算法也可以用来求解$p -$中心问题，例如禁忌搜索算法、可变邻域搜索算法、模拟退货算法等等。

$p -$中心选址问题常常应用在军队、医院、应急服务设施的选址上，因为这些设施通常有服务承诺，或者说这些设施的目标通常是降低最坏情况发生的风险，这一类目标通常被称为"经济平衡性"目标。

## 2.4 其他选址问题

后来，研究学者们以这三个选址问题作为基础，研究了更贴近实际也更复杂的一些选址问题模型，这些模型主要有带固定费用和容量限制的选址问题模型、多目标选址问题模型、可靠性选址问题模型、竞争选址问题模型、截流问题模型、hub选址问题模型、随机选址问题模型和动态选址问题模型等等。

## 2.5 主要研究问题和研究方法

### 2.5.1 容量限制的设施选址问题

本文主要研究带固定费用和容量限制的设施选址问题。带固定费用和容量限制的设施选址问题考虑现实中设施的建设费用以及设施的容量限制。而这一类模型又通常分为两类：
一类是无容量限制的固定费用选址问题（Uncapacitated Facility Location
Problem, UFLP）$^{\lbrack 7\rbrack}$，这一类问题考虑设施建设费用，但是不考虑设施的容量限制。记顾客集合$C$，一个候选设施集合$F$，候选设施集合中的每个设施$F_{i}$都有一定的建设费用$f_{i} \in R^{+}$，任意顾客和候选设施之间都有一定的服务费用$d_{ij} \in R^{+}$，我们的目标就是在候选设施集合$F$中选取一个子集，使得每个顾客都有一个设施来服务，并且尽量使总成本（设施的建设费用和设施与顾客的服务费用之和）最小，则强容量限制的选址问题模型的可以描述为下列的整数规划模型：

$$min\sum_{i \in I}^{}{f_{i}y_{i}} + \sum_{i \in I}^{}{\sum_{j \in J}^{}{d_{ij}x_{ij}}}$$

$$s.t.x_{ij} \leq y_{i},\ \forall i,\ \forall j$$

$$\sum_{i \in I}^{}x_{ij} = 1,\ \forall j$$

$$x_{ij},y_{j} \in \{ 0,\ 1\},\forall i,\forall j$$

其中，$i$为顾客的序号，$j$为候选设施的序号，$x_{ij}$为候选设施$j$是否为顾客$i$服务，若候选设施$j$为顾客$i$服务，则$x_{ij}$为1，否则为0，$y_{j}$为候选设施$j$是否建设，若候选设施$j$建设，则$y_{j}$为1，否则为0。约束（1）式表示只有建立的设施才能为顾客提供服务，约束（2）式表示候选设施服务的顾客数不能超过它的容量上限，约束（3）式表示，约束（4）式是变量的取值范围约束。

另一类是带容量限制的选址问题（Capacitated Facility Location Problem, CFLP），本文主要研究的就是这一类问题。这一类问题又可以分为弱容量限制的选址问题（Soft-Capacitated Facility Location Problem, SCFLP）和强容量限制的选址问题（Hard-Capacitated Facility Location Problem, HCFLP）。弱容量限制的选址问题对设施的连接数加以限制，每个设施最多连接$u_{i}$个顾客，但是每个地点允许建设多个设施；而强容量限制的是选址问题，除了限制每个设施最多连接$u_{i}$个顾客，还限制每个地点仅能建设一个设施。

### 2.5.2 竞争决策算法简介

宁爱兵等人在文章中提出了一种新型的启发式算法----竞争决策算法$^{\lbrack 8\rbrack}$，这种算法可以用来求解组合优化的问题$^{\lbrack 10-16\rbrack}$，并且取得了不错的解。选址问题也是一种组合优化问题，何永梅等人采用竞争决策算法对软容量限制的选址问题进行了求解$^{\lbrack 9\rbrack}$，证实了竞争决策算法可以用来求解选址问题。

竞争决策算法（Competitive Decision Algorithm, CDA）是在某种规则下，模拟竞争者和资源的竞争来求解问题的算法。

竞争决策算法的思想来自于自然界中优胜劣汰，适者生存的性质。自然界中资源的分配往往是在一定的初始状态下，在竞争者的绝对实力、竞争者间的相对实力差距、竞争者对环境的适应能力等多因素的影响下，经过多轮竞争和决策，最终达到另一种资源分配的均衡状态，如果这一状态的结果要优于初始状态，那么就达到了优化的目的。

竞争决策算法就是利用这一原理，通过模拟多个竞争者对资源进行竞争，根据一定的竞争原则对资源重新进行分配，最终使得一些更具优势的竞争者分配到更多的资源，而处于劣势的竞争者失去资源，最终达到总体目标最优或近似最优。

### 2.3.3 竞争决策算法基本概念$^{\lbrack 8\rbrack}$

竞争者：参与竞争的对象，可以占有和争夺资源。

资源：竞争者竞争的对象，可以被竞争者占有和争夺。

竞争决策状态：指的是竞争者占有资源的状态。初始状态就是竞争开始前竞争者占有的资源状态。结束状态就是最终竞争者占有的资源状态。

竞争决策均衡：指的是一种特殊的竞争决策状态。竞争决策均衡状态下，不存在一个竞争者根据竞争力函数和决策函数占有更多的资源。

竞争力函数：用于计算某个竞争者对某个资源的竞争力。

决策函数：用于每局竞争中分配资源给竞争者，并计算新的竞争决策状态。

总费用函数：用于计算当前竞争决策状态的优劣，通常就是问题的目标函数。

资源交换规则：在竞争决策均衡状态下，通过资源交换规则使竞争进入一个非稳定的竞争决策状态。

# 3 软容量限制的设施选址问题

## 3.1 模型描述

软容量限制的选址问题研究的是设施提供服务的能力有限，但是可以通过多次建设设施来使设施的服务能力得到提升，目标是追求建设费用和服务费用之和最小。

在软容量限制的设施选址问题中，我们有一个顾客集合$C$，一个候选设施集合$F$，候选设施集合中的每个设施$F_{i}$都有一定的建设费用$f_{i} \in R^{+}$，且有一定的服务能力限制（最多服务几个顾客）$u_{i} \in N^{*}$，但是，每个候选设施可以建设多次，每次建设都需要支付建设费用，任意顾客和候选设施之间都有一定的服务费用$d_{i}j \in R^{+}$，我们的目标就是在候选设施集合$F$中选取一个子集，使得每个顾客都有一个设施来服务，并且尽量使总成本（设施的建设费用和设施与顾客的服务费用之和）最小。

软容量限制的选址问题模型的可以描述为下列的整数规划模型：

$$min\sum_{i \in I}^{}{f_{i}y_{i}} + \sum_{i \in I}^{}{\sum_{j \in J}^{}{d_{ij}x_{ij}}}$$

$$s.t.x_{ij} \leq y_{i},\ \forall i,\ \forall j$$

$$\sum_{j \in J}^{}x_{ij} \leq u_{i}y_{i},\forall i$$

$$\sum_{i \in I}^{}x_{ij} = 1,\ \forall j$$

$$x_{ij} \in \{ 0,\ 1\},\forall i,\forall j$$

$$y_{j} \in N^{*},\forall j$$

其中，$i$为顾客的序号，$j$为候选设施的序号，$x_{ij}$为候选设施$j$是否为顾客$i$服务，若候选设施$j$为顾客$i$服务，则$x_{ij}$为1，否则为0，$y_{j}$为候选设施$j$是否建设，若候选设施$j$建设，则$y_{j}$为1，否则为0。约束（1）式表示只有建立的设施才能为顾客提供服务，约束（2）式表示候选设施服务的顾客数不能超过它的容量上限，约束（3）式表示，约束（4）（5）式是变量的取值范围约束。

## 3.2 数学性质

何永梅等人在文章中总结了软容量限制的设施选址问题的数学性质，本文对何永梅等人总结的数学性质重新进行了整理和归纳，得到如下四条性质：

**性质1** 如果设施$F_{i_{1}}$和设施$F_{i_{2}}$满足下列条件：

（1）$F_{i_{1}}$的建设费用小于$F_{i_{2}}$的建设费用。

（2）存在顾客$C_{j} \in C$，$F_{i_{1}}$的服务费用加$F_{i_{1}}$的建设费用小于$F_{i_{2}}$的服务费用。

则称对于顾客$C_{j}$来说，设施$F_{i_{2}}$相对设施$F_{i_{1}}$为劣势设施，设施$F_{i_{1}}$相对设施$F_{i_{2}}$为优势设施。如果顾客$C_{j}$可以由设施$F_{i_{1}}$服务，则一定不由设施$F_{i_{1}}$服务。

**证明：**
在容量限制的选址问题中，如果顾客$C_{j}$被设施$F_{i_{2}}$服务，那么可以用设施$F_{i_{1}}$来替代设施$F_{i_{2}}$，且替代后可以使目标函数更优，故设施$F_{i_{1}}$为顾客$C_{j}$提供服务的解要优于设施$F_{i_{2}}$为顾客$C_{j}$提供服务的解。

特殊地，如果对于顾客$C_{j} \in C$来说，所有设施相对某一设施都为劣势设施，则该设施称为对于顾客$C_{j}$来说的绝对优势设施。所以有下列性质：

**性质2** 如果设施$F_{i_{\min}}$满足下列条件：

（1）对任意设施$F_{i_{k}} \in F$，都满足$F_{i_{\min}}$的建设费用小于$F_{i_{k}}$的建设费用。

（2）对任意设施$F_{i_{k}} \in F$，存在顾客$C_{j} \in C$，满足设施$F_{i_{\min}}$的服务费用加$F_{i_{\min}}$的建设费用小于设施$F_{i_{k}}$的服务费用。

则设施$F_{i_{\min}}$称为对于顾客$C_{j}$来说的绝对优势设施，设施$F_{i_{\min}}$一定建设为顾客$C_{j}$服务。

**证明：** 在容量限制的选址问题中，此性质显然成立。

**性质3** 如果设施$F_{i_{1}}$和设施$F_{i_{2}}$满足下列条件：

（1）$F_{i_{1}}$的建设费用小于$F_{i_{2}}$的建设费用。

（2）对于任意顾客$C_{j} \in C$，$F_{i_{1}}$的服务费用小于$F_{i_{2}}$的服务费用。

则称设施$F_{i_{2}}$相对设施$F_{i_{1}}$为劣势设施，设施$F_{i_{1}}$相对设施$F_{i_{2}}$为优势设施。如果顾客$C_{j} \in C$可以由设施$F_{i_{1}}$服务，则一定不由设施$F_{i_{1}}$服务。

**证明：**
在容量限制的选址问题中，设施$F_{i_{2}}$可以用设施$F_{i_{1}}$来替代，且替代后可以使目标函数更优，故不建设设施$F_{i_{2}}$的解要优于建设设施$F_{i_{2}}$的解。

特殊地，如果所有设施相对某一设施都为劣势设施，则该设施称为绝对优势设施。所以有下列性质：

**性质4** 如果设施$F_{i_{\min}}$满足下列条件：

（1）对任意设施$F_{i_{k}} \in F$，都满足$F_{i_{\min}}$的建设费用小于$F_{i_{k}}$的建设费用。

（2）对任意设施$F_{i} \in F$，和任意顾客$C_{j} \in C$，都满足$F_{i_{\min}}$的服务费用小于$F_{i}$的服务费用。

则设施$F_{i_{\min}}$称为绝对优势设施，且设施$F_{i_{\min}}$一定建设。并且，设施$F_{i_{\min}}$一定服务$u_{i_{\min}}$个顾客。

**证明：** 在容量限制的选址问题中，此性质显然成立。

## 3.3 竞争决策算法

何永梅等人利用竞争决策算法对软容量限制的设施选址问题进行了求解，本文同样利用竞争决策算法对软容量限制的选址问题进行求解，并且在何永梅等人研究的基础上对算法流程进行了进一步简化和整理。

### 3.3.1 竞争决策算法概念

在选址问题中，我们可以将设施看作竞争者，将顾客看作被设施竞争的资源，设施为顾客服务即竞争者获得了资源；当然，也可以将顾客看作竞争者，将设施看作被竞争的资源，顾客获得了设施的服务即竞争者获得了资源。但是为了便于理解，我们通常将设施看作竞争者，将顾客看作被设施竞争的资源。设施为顾客服务的情况就是竞争决策状态；设施为顾客服务的初始情况就是竞争决策状态的初始状态；设施服务顾客的最终情况就是竞争决策状态的结束状态，通常也是竞争决策均衡状态。

容易想到，设施对顾客的服务成本和设施的建设成本越低，竞争力越大；所以，我们规定竞争力函数与设施的对顾客的服务费用和设施的建设费用成反比。因为在软容量限制的设施选址问题中，设施可以开设多次以提高自己的服务容量，所以如果服务该顾客不需要重新建立设施，即设施未确定建设，则竞争力函数值仅与设施的对顾客的服务费用成反比；否则，设施已经确定建设，竞争力函数值就与设施的对顾客的服务费用与设施的建设费用之和成反比。故软容量限制的设施选址问题中竞争力函数的表达式为：

$$compete\left( F_{i},C_{j} \right) = \left\{ \begin{matrix}
\frac{1}{{（d_{ij} + f_{i}）}}，\mathrm{设施未确定建设或容量已满} \\
\frac{1}{d_{ij}},\ \mathrm{设施已经确定建设且容量未满} \\
\end{matrix} \right.\ \ $$

相应地，因为软容量限制的设施选址问题中，设施可以开设多次，所以当设施容量已满，且仍要争夺资源时，就只需要重新开设一个设施，然后将资源分配给他即可。所以，软容量选址的设施选址问题中的决策函数为：在满足新的竞争决策状态的总费用函数值更小的前提下，分配顾客给竞争力函数值最大的设施。总费用函数就是目标函数，资源交换规则就是交换任意两个设施服务的任意两个顾客，使竞争进入一个非稳定的竞争决策状态。

### 3.3.2 竞争决策算法流程

**step 1：** 
设所有设施服务的顾客均为空集$\varnothing$。

根据性质1至性质4，绝对优势设施一定建设且服务的一定的顾客，相对劣势设施一定不服务顾客，所以关闭相对劣势设施，使之不参与竞争；同时，关闭绝对优势设施服务的顾客，使之不参与竞争。

**step 2：** 
根据初始的竞争决策状态，计算每一个设施对每一个顾客的竞争力函数值。

**step 3：**
按照次序分配顾客：根据目前的竞争决策状态，将顾客按照次序分配给竞争力最大且容量未满的设施。

**step 4：**
按照次序争夺顾客：

**step 4.1：**
根据目前的竞争决策状态（假设被争夺的顾客没有被设施服务），更新每一个设施对被争夺的顾客的竞争力函数值。

**step 4.2：**
如果设施$F_{i_{1}}$对顾客$C_{j}$的竞争力大于服务顾客$C_{j}$的设施$F_{i_{2}}$，则根据决策函数，如果满足分配顾客$C_{j}$给设施$F_{i_{1}}$可以使总费用函数值减少，则将顾客$C_{j}$分配给设施$F_{i_{1}}$，并更新竞争决策状态，重新按照次序争夺顾客。

**step 5：**
如果任一设施都不能根据竞争力函数和决策函数获得更多的顾客，即达到竞争决策均衡，或者超过了最大竞争步数，则进入**step 6**；否则进入**step 4**。

**step 6：**
关闭没有服务顾客的设施，根据资源交换规则交换设施的顾客，并进入**step 4**重新进行竞争，如果竞争结果优于目前最优的竞争结果，则更新最优竞争结果。

**step 7：** 
如果不能根据资源交换规则交换顾客，使竞争进入非稳定的竞争决策状态，或者超过了最大资源交换步数，则进入**step 8**；否则进入**step 6**。

**step 8：** 算法结束，输出目前最优的竞争结果。

## 3.3.3 算例

**算例 1**

设候选设施集合$F_{i} \in F,i = 1,2,3,4$，顾客集合$C_{j} \in C,j = 1,2,3,4,5$，设每个候选设施的服务容量均为2，候选设施的建设费用：

$$H = \lbrack 8, 9, 9, 11 \rbrack$$

候选设施与顾客的服务费用：

$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
D = \begin{bmatrix}
8 & 7 & 9 & 9 & 8 \\
9 & 7 & 9 & 9 & 6 \\
7 & 8 & 7 & 9 & 8 \\
6 & 8 & 9 & 5 & 8 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

**算法计算过程：**

第一步：根据性质1-4，没有设施必定开设，同时也没有设施必定为顾客服务，故初始的竞争决策状态为：所有设施服务的顾客为$\{\}$。

第二步：根据初始的竞争决策状态，计算所有设施的竞争力函数值，得到竞争力函数矩阵：
$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
K = \begin{bmatrix}
1/16 & 1/15 & 1/17 & 1/17 & 1/16 \\
1/18 & 1/16 & 1/18 & 1/18 & 1/15 \\
1/16 & 1/17 & 1/16 & 1/18 & 1/17 \\
1/17 & 1/19 & 1/20 & 1/16 & 1/19 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

第三步：将剩余的顾客分配给竞争力函数最大且容量未满的设施。得到新的竞争决策状态，此时设施服务顾客的情况：$F_{1}：\{ C_{1}, C_{2} \}$，$F_{2}：\{ C_{5} \}$，$F_{3}：\{ C_{3} \}$，$F_{4}：\{ C_{4} \}$。

第四步：更新设施的竞争力函数值，得到竞争力函数矩阵：
$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
K = \begin{bmatrix}
1/16 & 1/15 & 1/17 & 1/17 & 1/16 \\
1/9 & 1/7 & 1/9 & 1/9 & 1/6 \\
1/7 & 1/8 & 1/7 & 1/9 & 1/8 \\
1/6 & 1/8 & 1/9 & 1/5 & 1/8 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

第五步：设施按照次序争夺顾客：

（1）对于$C_{1}$，更新$C_{1}$所在的列的竞争力函数矩阵值为：$H = [ 1/8; 1/9; 1/7; 1/6 ]$，当前服务$C_{1}$的设施$F_{1}$的竞争力小于设施$F_{4}$，且从$F_{1}$中剥夺顾客$C_{1}$给$F_{4}$能够使总费用函数值更小，所以根据决策函数，从$F_{1}$中剥夺顾客$C_{1}$给$F_{4}$，并更新竞争决策状态，重新按照次序争夺顾客。

（2）对于$C_{1}$，更新$C_{1}$所在的列的竞争力函数矩阵值为：$H = [ 1/8; 1/9; 1/7; 1/6 ]$，当前服务$C_{1}$的设施$F_{4}$的竞争力最大，所以根据决策函数，不重新分配$C_{1}$。

（3）对于$C_{2}$，更新$C_{2}$所在的列的竞争力函数矩阵值为：$H = [ 1/15; 1/7; 1/8; 1/19 ]$，当前服务$C_{2}$的设施$F_{1}$的竞争力小于设施$F_{2}$，且从$F_{1}$中剥夺顾客$C_{2}$给$F_{2}$能够使总费用函数值更小，所以根据决策函数，从$F_{1}$中剥夺顾客$C_{2}$给$F_{2}$，并更新竞争决策状态，重新按照次序争夺顾客。

（4）对于$C_{1}$，更新$C_{1}$所在的列的竞争力函数矩阵值为：$H = [ 1/16; 1/18; 1/7; 1/6 ]$，当前服务$C_{1}$的设施$F_{4}$的竞争力最大，所以根据决策函数，不重新分配$C_{1}$。

（5）对于$C_{2}$，更新$C_{2}$所在的列的竞争力函数矩阵值为：$H = [ 1/15; 1/7; 1/7; 1/19 ]$，当前服务$C_{2}$的设施$F_{2}$的竞争力最大，所以根据决策函数，不重新分配$C_{2}$。

（6）对于$C_{3}$，更新$C_{3}$所在的列的竞争力函数矩阵值为：$H = [ 1/17; 1/9; 1/7; 1/20 ]$，当前服务$C_{3}$的设施$F_{3}$的竞争力最大，所以根据决策函数，不重新分配$C_{3}$。

（7）对于$C_{4}$，更新$C_{4}$所在的列的竞争力函数矩阵值为：$H = [ 1/18; 1/9; 1/9; 1/5 ]$，当前服务$C_{4}$的设施$F_{4}$的竞争力最大，所以根据决策函数，不重新分配$C_{4}$。

（8）对于$C_{5}$，更新$C_{5}$所在的列的竞争力函数矩阵值为：$H = [ 1/16; 1/6; 1/8; 1/19 ]$，当前服务$C_{5}$的设施$F_{2}$的竞争力最大，所以根据决策函数，不重新分配$C_{5}$。

第六步：此时，对于$C_{1}$、$C_{2}$、$C_{3}$、$C_{4}$、$C_{5}$，均没有竞争者可以根据竞争力函数和决策函数争夺到顾客，所以此时达到竞争决策均衡状态，将此时的竞争决策均衡状态记为最优竞争结果。

第七步：关闭没有服务顾客的设施，根据资源交换规则交换任意两个设施的任意两个顾客，重新竞争，竞争结果均不优于最优竞争结果，故转到第八步。

第八步：输出竞争结果，此时每个设施占有的顾客：$F_{2}：\{ C_{2},C_{5} \}$，$F_{3}：\{ C_{3} \}$，$F_{4}：\{ C_{1},C_{4} \}$，其余设施占有的顾客为$\{\}$，总费用函数值（即目标函数值）为60。

经验证，该解为整数规划的最优解，验证了算法的有效性。

## 3.4 基于混合策略的竞争决策算法

基于混合策略的竞争决策算法是一种改进的竞争决策算法。因为受到计算资源的限制，在竞争决策算法中，竞争并不是无限进行下去的，而是有最大竞争步数限制，当竞争的步数超过了最大竞争步数限制，也就达到了竞争决策算法的终止条件，我们会终止竞争，进入算法的下一步或者输出竞争结果。这时得到的解往往不是竞争决策均衡状态的解，仍有继续优化的空间。所以，我们引入混合策略的概念，在竞争决策算法达到终止条件之后，不输出竞争结果，而是根据当前的竞争决策状态，按照混合策略再分配一次顾客。具体的分配顾客混合策略就是，将顾客按照一定的概率分配给竞争力大于平均值的设施，分配的概率为：

$$
h(F_{i},C_{j}) = 
\left\{ 
\begin{matrix}
\frac{K_{ij}}{ \sum_{K_{ij} > \bar{K_{j}}}{K_{ij}}}
,K_{ij} > \bar{K_{j}}
\\
0
,K_{ij} <= \bar{K_{j}}
\end{matrix}
\right.
$$

其中，$\bar{K_{j}}$为所有设施对顾客$j$的竞争力的平均值，即$\bar{K_{j}} = \frac{ \sum_{i \in I}{K_{ij}}}{|I|}$

按照混合策略分配完顾客后，计算按照混合策略分配的总费用函数值，如果按照混合策略分配的总费用函数值要小于按照纯策略分配的总费用函数值，则采用混合策略分配的结果作为输出的结果，否则就采用纯策略分配的结果作为输出结果。最终的输出结果可以表示为：

$$
Opt = 
\left\{ 
\begin{matrix}
Opt_{CDA}
,Cost_{CDA} <= E_{CDA}
\\
Opt_{E_{CDA}}
,Cost_{CDA} > E_{CDA}
\end{matrix}
\right.
$$

其中，$Opt_{CDA}$表示竞争决策算法得到的解，$Opt_{E_{CDA}}$表示基于混合策略重新分配得到的解，$Cost_{CDA}$表示竞争决策算法得到的解的总费用函数值，$E_{CDA}$表示基于混合策略重新分配得到的解的总费用函数值。

在得到混合策略的解之后，我们可以通过一定的方法对混合策略的解进行取整，从而得到不差于混合策略解的纯策略解，也就是更优的整数规划解。

### 3.4.1 算例

**算例 2**

以竞争决策算法求解的**算例 1**为例，验证基于混合策略的竞争决策算法的有效性。因为**算例 1**已经求得了整数规划问题的最优解，使用基于混合策略的竞争决策算法必然不能找到更优的解，所以，我们限制竞争决策算法流程中第四步的最大竞争步数，使得竞争决策算法经过竞争阶段后输出的解不是最优解，然后采用混合策略继续分配，查看混合策略得到的解是否更优。

对于**算例 1**，我们限制其最大竞争步数为1次，此时每个设施占有的顾客：$F_{1}：\{ C_{2} \}$，$F_{2}：\{ C_{5} \}$，$F_{3}：\{ C_{3} \}$，$F_{4}：\{ C_{1},C_{4} \}$，总费用函数值（即目标函数值）为68。

此时，竞争力函数矩阵为：
$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
K = \begin{bmatrix}
1/8 & 1/7 & 1/9 & 1/9 & 1/8 \\
1/9 & 1/7 & 1/9 & 1/9 & 1/6 \\
1/7 & 1/8 & 1/7 & 1/9 & 1/8 \\
1/17 & 1/19 & 1/20 & 1/16 & 1/19 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

根据竞争力函数矩阵，依次将顾客按照概率分配给设施：

(1)对于顾客$C_{1}$，所有设施的竞争力平均值约为0.11，竞争力大于平均值的设施有$F_{1}$、$F_{2}$、$F_{3}$，所以将顾客$C_{1}$分别以0.33、0.29、0.38的概率分配给设施$F_{1}$、$F_{2}$、$F_{3}$。

(2)对于顾客$C_{2}$，所有设施的竞争力平均值约为0.12，竞争力大于平均值的设施有$F_{1}$、$F_{2}$、$F_{3}$，所以将顾客$C_{1}$分别以0.35、0.35、0.30的概率分配给设施$F_{1}$、$F_{2}$、$F_{3}$。

(3)对于顾客$C_{3}$，所有设施的竞争力平均值约为0.10，竞争力大于平均值的设施有$F_{1}$、$F_{2}$、$F_{3}$，所以将顾客$C_{1}$分别以0.30、0.30、0.40的概率分配给设施$F_{1}$、$F_{2}$、$F_{3}$。

(4)对于顾客$C_{4}$，所有设施的竞争力平均值约为0.10，竞争力大于平均值的设施有$F_{1}$、$F_{2}$、$F_{3}$，所以将顾客$C_{1}$分别以0.33、0.33、0.33的概率分配给设施$F_{1}$、$F_{2}$、$F_{3}$。

(5)对于顾客$C_{5}$，所有设施的竞争力平均值约为0.12，竞争力大于平均值的设施有$F_{1}$、$F_{2}$、$F_{3}$，所以将顾客$C_{1}$分别以0.33、0.4、0.3的概率分配给设施$F_{1}$、$F_{2}$、$F_{3}$。

此时，计算总费用函数（即目标函数）的期望值：$E = 65.6366$。可以看到，使用混合策略进行分配得到的总费用函数（即目标函数）值更小，验证了使用混合策略进行分配的有效性。

**其他算例**

为了更好的验证基于混合策略的竞争决策算法的有效性，我们采用NodeJS实现了软容量限制的设施选址问题下的基于混合策略的竞争决策算法，采用随机生成的方法，计算不同规模和限制下（设施数、顾客数、容量限制、最大竞争步数不同）的1000个算例的结果，对比使用混合策略和使用纯策略的总费用函数（即目标函数）的值的大小，得到的结果如下表所示：

设施数 | 顾客数 | 设施容量 | 最大竞争步数 | 基于混合策略竞争决策算法结果优于竞争决策算法的比例
---|---|---|---|---
4 | 5 | 2 | 1 | 43%
4 | 7 | 2 | 1 | 55%
4 | 7 | 3 | 1 | 12%
5 | 6 | 2 | 1 | 12%
5 | 9 | 2 | 1 | 37%
5 | 9 | 3 | 1 | 10%
8 | 9 | 2 | 2 | 11%
8 | 15 | 2 | 2 | 43%

从上面的数据中，我们可以看到：

（1）在相同的设施数、设施容量和竞争步数的情况下，顾客数越多，采用混合策略分配得到的解更优的比例就越大。

（2）在相同的顾客数、设施容量和竞争步数的情况下，设施数越少，采用混合策略分配得到的解更优的比例就越大。

（3）在相同的设施数、顾客数和竞争步数的情况下，设施容量越少，采用混合策略分配得到的解更优的比例就越大。

以上三点都说明了基于混合策略的竞争决策算法对于求解顾客数多、设施数和容量少的情景十分适用。

（4）在相同的设施数、设施容量和顾客数的情况下，竞争步数越少，采用混合策略分配得到的解更优的比例就越大，因为竞争步数越多，使用纯策略得到的解为最优解或局部最优解的几率就越大，使用混合策略得到的解的就往往不会比纯策略得到的解更优。

（5）对于较大规模（如图1所示）和较小规模（如图5所示）的问题，在达到最大竞争步数后使用混合策略再一次进行分配均有较高的较高的概率得到比纯策略更优的解。因此，基于混合策略的竞争决策算法是对竞争决策算法的一种有效的改进。

# 4 强容量限制的设施选址问题

## 4.1 模型描述

强容量限制的设施选址问题在生产和生活中十分常见。它研究的就是在考虑设施服务能力限制的条件下，选取设施的位置来服务顾客，使得总成本（设施建设成本和服务成本）最小的问题。

在强容量限制的设施选址问题中，我们有一个顾客集合$C$，一个候选设施集合$F$，候选设施集合中的每个设施$F_{i}$都有一定的建设费用$f_{i} \in R^{+}$，且有一定的服务能力限制（最多服务几个顾客）$u_{i} \in N^{*}$，任意顾客和候选设施之间都有一定的服务费用$d_{ij} \in R^{+}$，我们的目标就是在候选设施集合$F$中选取一个子集，使得每个顾客都有一个设施来服务，并且尽量使总成本（设施的建设费用和设施与顾客的服务费用之和）最小。

强容量限制的选址问题模型的可以描述为下列的整数规划模型：

$$min\sum_{i \in I}^{}{f_{i}y_{i}} + \sum_{i \in I}^{}{\sum_{j \in J}^{}{d_{ij}x_{ij}}}$$

$$s.t.x_{ij} \leq y_{i},\ \forall i,\ \forall j$$

$$\sum_{j \in J}^{}x_{ij} \leq u_{i}y_{i},\forall i$$

$$\sum_{i \in I}^{}x_{ij} = 1,\ \forall j$$

$$x_{ij},y_{j} \in \{ 0,\ 1\},\forall i,\forall j$$

其中，$i$为顾客的序号，$j$为候选设施的序号，$x_{ij}$为候选设施$j$是否为顾客$i$服务，若候选设施$j$为顾客$i$服务，则$x_{ij}$为1，否则为0，$y_{j}$为候选设施$j$是否建设，若候选设施$j$建设，则$y_{j}$为1，否则为0。约束（1）式表示只有建立的设施才能为顾客提供服务，约束（2）式表示候选设施服务的顾客数不能超过它的容量上限，约束（3）式表示，约束（4）式是变量的取值范围约束。

## 4.2 数学性质

可以证明，在强容量限制的选址问题中介绍的性质1至性质4在软容量限制的设施选址问题中依然成立。

## 4.3 竞争决策算法

该模型同样可以使用竞争决策算法进行求解，本文在软容量限制的设施选址问题的竞争决策算法的基础上进行了改进，给出了强容量限制的设施选址问题下的竞争决策算法流程。

### 4.3.1 竞争决策算法概念

因为在强容量限制的设施选址问题中，设施只能服务一定数量的顾客，且无法开设多次，所以，如果服务该顾客不需要重新建立设施，即设施未确定建设，则竞争力函数值仅与设施的对顾客的服务费用成反比；否则，设施已经确定建设，竞争力函数值就与设施的对顾客的服务费用与设施的建设费用之和成反比，故强容量限制的选址问题中的竞争力函数表达式为：

$$compete\left( F_{i},C_{j} \right) = \left\{ \begin{matrix}
\frac{1}{{（d_{ij} + f_{i}）}}，\mathrm{设施未确定建设} \\
\frac{1}{d_{ij}},\mathrm{设施已经确定建设} \\
\end{matrix} \right.\ \ $$

相应的，因为在强容量限制的设施选址问题中，设施只能服务一定数量的顾客，且无法开设多次，所以强容量限制的设施选址问题中的决策函数为：在满足新的竞争决策状态的总费用函数值更小的前提下，分配顾客给竞争力函数值最大的设施，如果设施的容量未满，则直接分配顾客给设施；如果设施的容量已满，则在设施服务的顾客中选取一个竞争力函数最小的顾客作为交换，然后分配顾客给设施。而强容量限制的设施选址问题中，总费用函数和资源交换规则与软容量限制的相同。

### 4.3.2 竞争决策算法流程

因为强容量限制的设施选址问题中，设施的服务能力有限，所以在分配顾客给设施的时候还需要考虑设施是否达到服务能力上限，具体的算法流程如下：

**step 1：** 
设所有设施服务的顾客均为空集｛｝。

根据性质1至性质4，绝对优势设施一定建设且服务的一定的顾客，相对劣势设施一定不服务顾客，所以关闭绝对优势设施和相对劣势设施，使之不参与竞争；同时，关闭绝对优势设施服务的顾客，使之不参与竞争。

**step 2：** 
根据初始的竞争决策状态，计算每一个设施对每一个顾客的竞争力函数值

**step 3：**
按照次序分配顾客：根据目前的竞争决策状态，将顾客按照次序分配给竞争力最大且容量未满的设施。

**step 4：**
按照次序争夺顾客：

**step 4.1：**
根据目前的竞争决策状态（假设被争夺的顾客没有被设施服务），更新每一个设施对被争夺的顾客的竞争力函数值。

**step 4.2：**
如果设施$F_{i_{1}}$对顾客$C_{j}$的竞争力大于服务顾客$C_{j}$的设施$F_{i_{2}}$，则根据决策函数：
（1）如果设施$F_{i_{1}}$容量未满，且满足分配顾客给设施可以使总费用函数值减少，则将顾客$C_{j}$分配给设施$F_{i_{1}}$，并更新竞争决策状态
（2）如果设施$F_{i_{1}}$的容量已满，则在设施$F_{i}$服务的顾客中选取一个竞争力函数最小的顾客作为交换分配给$F_{i_{2}}$，如果满足分配顾客给设施可以使总费用函数值减少，则将顾客$C_{j}$分配给设施$F_{i_{1}}$，并更新竞争决策状态，重新按照次序争夺顾客。

**step 5：**
如果任一设施都不能根据竞争力函数和决策函数获得更多的顾客，即达到竞争决策均衡，或者超过了最大竞争步数，则进入**step 6**；否则进入**step 4**。

**step 6：**
关闭没有服务顾客的设施，根据资源交换规则交换设施的顾客，并进入**step 4**重新进行竞争，如果竞争结果优于目前最优的竞争结果，则更新最优竞争结果。

**step 7：** 
如果不能根据资源交换规则交换顾客，使竞争进入非稳定的竞争决策状态，或者超过了最大资源交换步数，则进入**step 8**；否则进入**step 6**。

**step 8：** 算法结束，输出目前最优的竞争结果。

## 4.3.3 算例

**算例 3**

设候选设施集合$F_{i} \in F,i = 1,2,3,4$，顾客集合$C_{j} \in C,j = 1,2,3,4,5$，设每个候选设施的服务容量均为2，候选设施的建设费用：

$$H = \lbrack 10, 13, 13, 9 \rbrack$$

候选设施与顾客的服务费用：

$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
D = \begin{bmatrix}
9 & 5 & 9 & 5 & 6 \\
5 & 7 & 7 & 9 & 8 \\
9 & 9 & 9 & 8 & 8 \\
8 & 6 & 9 & 7 & 5 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

**算法计算过程：**

第一步：根据性质1-4，没有设施必定开设，同时也没有设施必定为顾客服务，故初始的竞争决策状态为：所有设施服务的顾客为$\{\}$

第二步：根据初始的竞争决策状态，计算所有设施的竞争力函数值，得到竞争力函数矩阵：
$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
K = \begin{bmatrix}
1/19 & 1/15 & 1/19 & 1/15 & 1/16 \\
1/18 & 1/20 & 1/20 & 1/22 & 1/21 \\
1/22 & 1/22 & 1/22 & 1/21 & 1/21 \\
1/17 & 1/15 & 1/18 & 1/16 & 1/14 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

第三步：将剩余的顾客分配给竞争力函数最大且容量未满的设施。得到新的竞争决策状态，此时设施服务顾客的情况：$F_{1}：\{ C_{2}, C_{4} \}$，$F_{2}：\{ C_{5} \}$，$F_{4}：\{ C_{1}, C_{3} \}$，其余设施服务的顾客为$\varnothing$。

第四步：更新设施的竞争力函数值，得到竞争力函数矩阵：
$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
K = \begin{bmatrix}
1/9 & 1/5 & 1/9 & 1/5 & 1/6 \\
1/5 & 1/7 & 1/7 & 1/9 & 1/8 \\
1/22 & 1/22 & 1/22 & 1/21 & 1/21 \\
1/8 & 1/6 & 1/9 & 1/7 & 1/5 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

第五步：设施按照次序争夺顾客：

（1）对于$C_{1}$，更新$C_{1}$所在的列的竞争力函数矩阵值为：$H = [ 1/9; 1/5; 1/22; 1/8 ]$，当前服务$C_{1}$的设施$F_{4}$的竞争力小于设施$F_{2}$，且从$F_{4}$中剥夺顾客$C_{1}$给$F_{2}$能够使总费用函数值更小，所以根据决策函数，从$F_{4}$中剥夺顾客$C_{1}$给$F_{2}$，并更新竞争决策状态，重新按照次序争夺顾客。

（2）对于$C_{1}$，更新$C_{1}$所在的列的竞争力函数矩阵值为：$H = [ 1/9; 1/5; 1/22; 1/8 ]$，当前服务$C_{1}$的设施$F_{2}$的竞争力最大，所以根据决策函数，不重新分配$C_{1}$。

（3）对于$C_{2}$，更新$C_{2}$所在的列的竞争力函数矩阵值为：$H = [ 1/5; 1/7; 1/22; 1/6 ]$，当前服务$C_{2}$的设施$F_{1}$的竞争力最大，所以根据决策函数，不重新分配$C_{2}$。

（4）对于$C_{3}$，更新$C_{3}$所在的列的竞争力函数矩阵值为：$H = [ 1/9; 1/7; 1/22; 1/9 ]$，当前服务$C_{3}$的设施$F_{4}$的竞争力小于设施$F_{2}$，且从$F_{4}$中剥夺顾客$C_{3}$给$F_{2}$并从$F_{2}$中换出竞争力小的顾客$C_{5}$给$F_{4}$能够使总费用函数值更小，所以根据决策函数，从$F_{4}$中剥夺顾客$C_{3}$给$F_{2}$并从$F_{2}$中换出顾客$C_{5}$给$F_{4}$，并更新竞争决策状态，重新按照次序争夺顾客。

（5）对于$C_{1}$，更新$C_{1}$所在的列的竞争力函数矩阵值为：$H = [ 1/9; 1/5; 1/22; 1/8 ]$，当前服务$C_{1}$的设施$F_{2}$的竞争力最大，所以根据决策函数，不重新分配$C_{1}$。

（6）对于$C_{2}$，更新$C_{2}$所在的列的竞争力函数矩阵值为：$H = [ 1/5; 1/7; 1/22; 1/6 ]$，当前服务$C_{2}$的设施$F_{1}$的竞争力最大，所以根据决策函数，不重新分配$C_{2}$。

（7）对于$C_{3}$，更新$C_{3}$所在的列的竞争力函数矩阵值为：$H = [ 1/9; 1/7; 1/22; 1/9 ]$，当前服务$C_{3}$的设施$F_{2}$的竞争力最大，所以根据决策函数，不重新分配$C_{2}$。

（8）对于$C_{4}$，更新$C_{4}$所在的列的竞争力函数矩阵值为：$H = [ 1/5; 1/9; 1/21; 1/7 ]$，当前服务$C_{4}$的设施$F_{1}$的竞争力最大，所以根据决策函数，不重新分配$C_{4}$。

（9）对于$C_{5}$，更新$C_{5}$所在的列的竞争力函数矩阵值为：$H = [ 1/6; 1/8; 1/21; 1/5 ]$，当前服务$C_{5}$的设施$F_{2}$的竞争力最大，所以根据决策函数，不重新分配$C_{5}$。

第六步：此时，对于$C_{1}$、$C_{2}$、$C_{3}$、$C_{4}$、$C_{5}$，均没有竞争者可以根据竞争力函数和决策函数争夺到顾客，所以此时达到竞争决策均衡状态，将此时的竞争决策均衡状态记为最优竞争结果。

第七步：关闭没有服务顾客的设施，根据资源交换规则交换任意两个设施的任意两个顾客，重新竞争，竞争结果均不优于最优竞争结果，故转到第八步。

第八步：输出竞争结果，此时每个设施占有的顾客：$F_{1}：\{ C_{2}, C_{4} \}$，$F_{2}：\{ C_{1}, C_{3} \}$，$F_{4}：\{ C_{5} \}$，其余设施占有的顾客为$\{\}$，总费用函数值（即目标函数值）为59。

经验证，该解为整数规划的最优解，验证了算法的有效性。

### 4.4 基于混合策略的竞争决策算法

强容量限制的设施选址问题中，基于混合策略的竞争决策算法的基本概念与软容量限制的设施选址问题中的基本概念完全相同，这里直接通过算例来进行演示。

### 4.4.1 算例

**算例 4**

以竞争决策算法求解的**算例 3**为例，验证基于混合策略的竞争决策算法的有效性。类似的，因为**算例 3**已经求得了整数规划问题的最优解，使用基于混合策略的竞争决策算法必然不能找到更优的解，所以，我们限制竞争决策算法流程中第四步的最大竞争步数，使得竞争决策算法经过竞争阶段后输出的解不是最优解，然后采用混合策略继续分配，查看混合策略得到的解是否更优。

对于**算例 3**，我们限制其最大竞争步数为1次，此时每个设施占有的顾客：$F_{1}：\{ C_{2}, C_{4} \}$，$F_{2}：\{ C_{5} \}$，$F_{4}：\{ C_{1},C_{3} \}$，其余设施服务的顾客为$\{\}$，总费用函数值（即目标函数值）为68。

此时，竞争力函数矩阵为：
$$
\begin{matrix}
C_{1} & C_{2} & C_{3} & C_{4} & C_{5} \\
\end{matrix}
$$
$$
K = \begin{bmatrix}
1/9 & 1/5 & 1/9 & 1/5 & 1/6 \\
1/5 & 1/7 & 1/7 & 1/9 & 1/8 \\
1/22 & 1/22 & 1/22 & 1/21 & 1/21 \\
1/8 & 1/6 & 1/9 & 1/7 & 1/5 \\
\end{bmatrix}
\begin{matrix}
F_{1} \\
F_{2} \\
F_{3} \\
F_{4} \\
\end{matrix}
$$

根据竞争力函数矩阵，依次将顾客按照概率分配给设施：

(1)对于顾客$C_{1}$，所有设施的竞争力平均值约为0.12，竞争力大于平均值的设施有$F_{2}$、$F_{4}$，所以将顾客$C_{1}$分别以0.62、0.38的概率分配给设施$F_{2}$、$F_{4}$。

(2)对于顾客$C_{2}$，所有设施的竞争力平均值约为0.14，竞争力大于平均值的设施有$F_{1}$、$F_{2}$、$F_{4}$，所以将顾客$C_{2}$分别以0.39、0.28、0.33的概率分配给设施$F_{1}$、$F_{2}$、$F_{4}$。

(3)对于顾客$C_{3}$，所有设施的竞争力平均值约为0.10，竞争力大于平均值的设施有$F_{1}$、$F_{2}$、$F_{4}$，所以将顾客$C_{3}$分别以0.30、0.39、0.30的概率分配给设施$F_{1}$、$F_{2}$、$F_{4}$。

(4)对于顾客$C_{4}$，所有设施的竞争力平均值约为0.13，竞争力大于平均值的设施有$F_{1}$、$F_{4}$，所以将顾客$C_{4}$分别以0.58、0.42的概率分配给设施$F_{1}$、$F_{4}$。

(5)对于顾客$C_{5}$，所有设施的竞争力平均值约为0.13，竞争力大于平均值的设施有$F_{1}$、$F_{4}$，所以将顾客$C_{5}$分别以0.45、0.55的概率分配给设施$F_{1}$、$F_{4}$。

此时，计算总费用函数（即目标函数）的期望值：$E = 63.5469$。可以看到，使用混合策略进行分配得到的总费用函数（即目标函数）值更小，验证了使用混合策略进行分配的有效性。

**其他算例**

为了更好的验证基于混合策略的竞争决策算法的有效性，我们采用NodeJS实现了强容量限制的设施选址问题下的基于混合策略的竞争决策算法，采用随机生成的方法，计算不同规模和限制下（设施数、顾客数、容量限制、最大竞争步数不同）的1000个算例的结果，对比使用混合策略和使用纯策略的总费用函数（即目标函数）的值的大小，得到的结果如下表所示：

设施数 | 顾客数 | 设施容量 | 最大竞争步数 | 基于混合策略竞争决策算法结果优于竞争决策算法的比例
---|---|---|---|---
4 | 5 | 2 | 1 | 7%
4 | 7 | 2 | 1 | 14%
4 | 7 | 3 | 1 | 20%
5 | 6 | 2 | 1 | 8%
5 | 9 | 2 | 1 | 11%
5 | 9 | 3 | 1 | 18%
8 | 9 | 2 | 2 | 11%
8 | 15 | 2 | 2 | 27%
8 | 15 | 3 | 2 | 15%

从上面的数据中，我们可以看到，基于混合策略的竞争决策算法对于强容量限制的设施选址问题同样具有有效性，并且与软容量限制的设施选址问题中得到的结果大部分具有相同的性质，除此之外，可以看到：

（1）对于相同规模和最大竞争步数的问题，强容量限制的设施选址问题得到的解往往比软容量限制的设施选址问题的解更差，因为从整数规划的角度来讲，强软容量限制的设施选址问题的解的可行域要小于软容量限制的设施选址问题的解的可行域，所以最优解一般要差一些。

（2）对于相同规模和最大竞争步数的问题，强容量限制的设施选址问题得到的解往往比软容量限制的设施选址问题的解更差，因为从整数规划的角度来讲，强软容量限制的设施选址问题的解的可行域要小于软容量限制的设施选址问题的解的可行域，所以最优解一般要差一些。

# 总结与讨论

本文利用竞争决策算法分别对，

# 参考文献

[1]:杨丰梅, 华国伟, 邓猛, 黎建强. 选址问题研究的若干进展. 运筹与管理, 2005, 14(6):1-7.

[2]:Weber A. On the location of industries[M]. Chicago: University of Chicago Press, 1929.

[3]:Hakimi S L. Optimum locations of switching centers and medians of a graph[J]. Operations Research, 1964, 12:450-459.

[4]:Kariv O, Hakimi S L. An algorithmic approach to network location problem, part 2: the p-medians[J]. SIAM Journal Applied Mathematics, 1979, 37:539-560.

[5]:Toregas C, Swian R, ReVelle C, et al. The location of emergency service facilities[J]. Operations Research, 1971, 19:1363-1373.

[6]:Church R L, ReVelle C. Maximal covering location problem\[J\]. Papers of the Regional Science Association, 1974, 32:101-118.

[7]:安凤仙. k-层无容量限制的设施选址问题的一种算法[J]. 淮阴工学院学报, 2009, 18(5):1-4.

[8]:宁爱兵, 王波, 熊小华, 马良. 竞争决策算法原理及其应用[J]. 上海理工大学学报, 2008, 30(4):369-373.

[9]:何永梅, 宁爱兵, 彭大江, 尚春剑, 张惠珍. 软容量限制设施选址问题的竞争决策算法\[J\]. 计算机工程与应用, 2019(3).

[10]:宁爱兵, 马良. 竞争决策算法及其在车辆路径问题中的应用[J]. 管理科学学报,2005,8(6):10-18. 

[11]:宁爱兵, 马良. 度约束最小生成树(DCMST)的竞争决策算法[J]. 系统工程学报, 2005, 20(6):630-634. 

[12]:刘勇, 马良, 宁爱兵. 给定限期条件下应急选址问题的量子竞争决策算法[J]. 运筹与管理, 2011, 20(3):66-71. 

[13]:宁爱兵, 熊校华, 马良. 多目标旅行商问题的竞争决策算法[J]. 计算机工程与应用, 2009, 45(34):13-16.

[14]:熊小华, 宁爱兵, 马良. 多目标 0-1 背包问题的元胞竞争决策算法[J]. 计算机应用研究, 2010, 27(10):3680-3682. 

[15]:熊小华, 宁爱兵. 最小比率生成树的竞争决策算法[J]. 计算机工程与应用,2012,48(28),47-51. 

[16]:金婷婷, 王波, 宁爱兵. 最小顶点覆盖问题的竞争决策算法[J]. 计算机工程与应用, 2011, 47(1):32-34.